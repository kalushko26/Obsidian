____
tags: #JavaScript #FinalizationRegistry

_____
## –í–≤–µ–¥–µ–Ω–∏–µ

–ö–æ–≥–¥–∞ –º—ã —á—Ç–æ-—Ç–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–∏–±–æ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–º (–∑–Ω–∞—á–µ–Ω–∏–µ), –ª–∏–±–æ –æ–±—ä–µ–∫—Ç–Ω—ã–º (—Å—Å—ã–ª–æ—á–Ω—ã–π) —Ç–∏–ø–æ–º.
–í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –æ–±–∑–æ—Ä —Ç–∏–ø–æ–≤, —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å–∏–ª—å–Ω—ã–º–∏ –∏ —Å–ª–∞–±—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏, –∞ —Ç–∞–∫–∂–µ —Å–ø–æ—Å–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞ (GC).

## –ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ –∏ —Å—Å—ã–ª–æ—á–Ω—ã–µ —Ç–∏–ø—ã

[![–¢–∏–ø—ã —Å—Å—ã–ª–æ–∫ –∏ –∑–Ω–∞—á–µ–Ω–∏–π](https://res.cloudinary.com/practicaldev/image/fetch/s--xhEsicxE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w0jk7vfdqz4jvgf1umv7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--xhEsicxE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/w0jk7vfdqz4jvgf1umv7.png)

–¢–∏–ø—ã –∑–Ω–∞—á–µ–Ω–∏–π –∏ —Å—Å—ã–ª–æ–∫ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è.¬†–ù–∞–∏–±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Ç–æ, –∫–∞–∫ –º–µ—Ö–∞–Ω–∏–∑–º—ã —É–ø—Ä–∞–≤–ª—è—é—Ç —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

üìù –°—Ä–∞–≤–Ω–µ–Ω–∏–µ.¬†–ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ —Ç–∏–ø—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –ø–æ –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—é, —Å—Å—ã–ª–æ—á–Ω—ã–µ —Ç–∏–ø—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ:  

```javascript
1 === 1 // true
{} === {} // false
```

üìù –•—Ä–∞–Ω–∏–ª–∏—â–µ: —Ç–∏–ø—ã –∑–Ω–∞—á–µ–Ω–∏–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å—Ç–µ–∫–µ, —Å—Å—ã–ª–æ—á–Ω—ã–µ —Ç–∏–ø—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫—É—á–µ.¬†–°–∞–º–æ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –º–µ—Å—Ç–æ –≤ –∫—É—á–µ, –≥–¥–µ –æ–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è.  

```javascript
// obj is a reference to the `{}`
const obj = {};

// a stores the number 123 in stack
const a = 123;
```

üìù –ö–æ–≥–¥–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å—Ç–µ–∫–µ, –æ–Ω–∞ –æ—á–∏—â–∞–µ—Ç—Å—è, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:  

```javascript
// –ö–æ–≥–¥–∞ –º—ã –≤—ã–∑—ã–≤–∞–µ–º foo, –º—ã –ø–æ–º–µ—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
foo();

function foo() {
  // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ç–µ–∫ fooVariable –∏ —Ç–∞–∫ –∂–µ foo2
  let fooVariable = 123;
  let foo2;

  function bar() {
    // –ü–æ–º–µ—Å—Ç–∏—Ç–µ barVariable –≤ —Å—Ç–µ–∫
    let barVariable = 1234;

    // –ó–¥–µ—Å—å –º—ã –∫–æ–ø–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
    foo2 = barVariable;

    //  –ú—ã –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ `bar`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ `barVariable` –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞
  }
  // –ü–æ–º–µ—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `bar` –≤ —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
  bar();

  // –ú—ã –≤—ã—Ö–æ–¥–∏–º –∏–∑ `foo` fn, –ø–æ—ç—Ç–æ–º—É `fooVariable` –∏ `foo2` –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã
}
```

_–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≤ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ —É –Ω–∞—Å –µ—Å—Ç—å 2 –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤, –º–æ–∂–µ—Ç–µ –ª–∏ –≤—ã –∏—Ö –Ω–∞–π—Ç–∏?_

> –û—Ç–≤–µ—á–∞—Ç—å
	–ú—ã –æ–±—ä—è–≤–∏–ª–∏ 2 —Ñ—É–Ω–∫—Ü–∏–∏:¬†`bar`–∏¬†`foo`.¬†–≠—Ç–æ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤
  
üìù –ü–æ—Å–∫–æ–ª—å–∫—É —Å—Å—ã–ª–æ—á–Ω—ã–µ —Ç–∏–ø—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫—É—á–µ, –¥–≤–∏–∂–∫–∏ –¥–æ–ª–∂–Ω—ã ¬´–ø–æ–Ω–∏–º–∞—Ç—å¬ª, –∫–æ–≥–¥–∞ –æ–Ω–∏ –º–æ–≥—É—Ç —Å–æ–±–∏—Ä–∞—Ç—å –æ–±—ä–µ–∫—Ç –∏ –æ—á–∏—â–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏–Ω–∞—á–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏.¬†–î–ª—è —ç—Ç–æ–≥–æ –¥–≤–∏–≥–∞—Ç–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ ( #GC ).

–°–∞–º–∞—è –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞ ‚Äî —ç—Ç–æ —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫:¬†–∫–∞–∫ –≤–∏–¥–∏—Ç–µ, –º—ã –Ω–µ –æ—á–∏—â–∞–µ–º –æ–±—ä–µ–∫—Ç, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏, –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ç–∏–ø–∞–º–∏ –∑–Ω–∞—á–µ–Ω–∏–π.¬†–û–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤—Å–µ –≤—Ä–µ–º—è, –ø–æ–∫–∞ —É –Ω–∞—Å –µ—Å—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –Ω–µ–≥–æ.  
[![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–µ–π—à–µ–≥–æ GC](https://res.cloudinary.com/practicaldev/image/fetch/s--GmP3DXbn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/vhgqlmv0newv2chfocw2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--GmP3DXbn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/vhgqlmv0newv2chfocw2.png)  

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–≤–∏–∂–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–ª–æ–∂–Ω—ã–µ —Å–±–æ—Ä—â–∏–∫–∏ –º—É—Å–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø–æ–∫–æ–ª–µ–Ω–∏—è –∏ —Ç. –¥. (–¥–∞–π—Ç–µ –º–Ω–µ –∑–Ω–∞—Ç—å, –µ—Å–ª–∏ –≤–∞–º —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –º—ã –º–æ–∂–µ–º —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ–± —ç—Ç–æ–º –≤ –±—É–¥—É—â–µ–º üòä)

–í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –¥–æ —Å–∏—Ö –ø–æ—Ä, —è–≤–ª—è—é—Ç—Å—è —Å–∏–ª—å–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏.¬†–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö —á–∞—â–µ –≤—Å–µ–≥–æ:  

```javascript
// –°–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –º–∞—Å—Å–∏–≤
const array = []; 

// –°–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç
const obj = {};

// –°–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É
const map = new Map();
```

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å–∏–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫, –º–Ω–æ–≥–∏–µ —è–∑—ã–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏.

## –°–ª–∞–±—ã–µ —Ä–µ—Ñ–µ—Ä–∏

üìù –°–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏ ‚Äî —ç—Ç–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞.¬†–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –æ–Ω–∏ –Ω–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç —Å–±–æ—Ä –º—É—Å–æ—Ä–∞ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞.

#WeakRef –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤–∏—á–æ–∫ –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ JS.¬†–û–Ω–∏ –Ω–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç GCed —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è:  
[![–°–ª–∞–±—ã–π –æ–ø–æ—Ä–Ω—ã–π GC](https://res.cloudinary.com/practicaldev/image/fetch/s--11QEIPoK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/vec5nogk8e4u8jobg1xw.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--11QEIPoK--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/vec5nogk8e4u8jobg1xw.png)

üìù –°–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏, –∫–æ–≥–¥–∞ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö —Å–∏–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫, –∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —ç—Ç–∞ —Å—Å—ã–ª–∫–∞ –º–µ—à–∞–ª–∞ —ç—Ç–æ–º—É.

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —è –≤–∏–¥–µ–ª —Ä–∞–Ω—å—à–µ:

1.  –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–º–∏—Å–æ–≤.¬†–û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏—Ö –≤ –ø–æ—Ä—è–¥–∫–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è: –Ω–∞–ø—Ä–∏–º–µ—Ä,¬†[¬´stack promises¬ª](https://www.npmjs.com/package/stack-promises)¬†.¬†–ß—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏, –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫¬†`WeakRef<Promise>`, –∏ –µ—Å–ª–∏ –∫–∞–∫–æ–µ-–ª–∏–±–æ –∏–∑ –æ–±–µ—â–∞–Ω–∏–π –±—É–¥–µ—Ç –ø–æ–¥–≤–µ—Ä–≥–Ω—É—Ç–æ —Å–±–æ—Ä–∫–µ –º—É—Å–æ—Ä–∞, –≤—ã –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç–µ –∑–∞–ø–∏—Å—å –≤ —Å–≤–æ–µ–º —Å–ø–∏—Å–∫–µ.
    
2.  –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–∞—Ä—Ç–∞, –∫–∞–∫–∏–µ –∫–ª—é—á–∏ —è–≤–ª—è—é—Ç—Å—è –æ–±—ä–µ–∫—Ç–∞–º–∏, –∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —ç—Ç–∞ –∫–∞—Ä—Ç–∞ —Ö—Ä–∞–Ω–∏–ª–∞ –æ–±—ä–µ–∫—Ç—ã –≤ –ø–∞–º—è—Ç–∏.¬†–ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫–∏–µ –∫–∞—Ä—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Å–∞–º–∏–º –æ–±—ä–µ–∫—Ç–æ–º, —Ç–∞–∫–∏—Ö –∫–∞–∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.¬†–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `WeakMap`
    
3.  –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–µ—à–∏: —É –Ω–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–µ—à, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤–Ω—É—Ç—Ä–∏ –∫–µ—à–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, LRU).¬†–î—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ‚Äî —Å–æ–∑–¥–∞—Ç—å –∫–µ—à, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–ø–∏—Å–æ–∫ WeakRefs.¬†–¢–∞–∫–æ–π –∫–µ—à –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —É –Ω–∞—Å –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ω–∏—Ö –∏–ª–∏ –¥–æ —Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞, –∫–æ–≥–¥–∞ —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ —É–¥–∞–ª–∏—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–ø–∏—Å–∏.

JavaScript –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 3 —Ç–∏–ø–∞¬†`Weak*`—Å—Ç—Ä—É–∫—Ç—É—Ä:  
üìù 1.¬†`WeakRef`—ç—Ç–æ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–∞–±—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –¥—Ä—É–≥–æ–π –æ–±—ä–µ–∫—Ç, –Ω–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –µ–≥–æ GCed.  
üìù 2.¬†`WeakMap`—è–≤–ª—è–µ—Ç—Å—è –∫–∞—Ä—Ç–æ–π, –Ω–æ –∫–ª—é—á–∏ —è–≤–ª—è—é—Ç—Å—è —Å–ª–∞–±—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏.¬†–ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ —Ç–∏–ø—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–µ–π –∑–∞–ø—Ä–µ—â–µ–Ω—ã –≤ WeakMaps.¬†–û–Ω –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–∑ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –≤—ã—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –æ–±—ä–µ–∫—Ç–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ).  
üìù 3.¬†`WeakSet`—ç—Ç–æ –Ω–∞–±–æ—Ä¬†`WeakRefs`–æ–±—ä–µ–∫—Ç–æ–≤.

**–í–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ**¬†: –Ω–µ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ç–µ—Å—Ç—ã —Å WeakRefs –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.¬†–í–∞—à–∏ –æ–±—ä–µ–∫—Ç—ã –Ω–µ –±—É–¥—É—Ç GCed –≤ –Ω–µ–º –∏–∑-–∑–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è DevTools.¬†–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ¬†[jsbin](https://jsbin.com/)¬†,¬†[codeandbox](https://codesandbox.io/)¬†,¬†[runkit](https://runkit.com/)¬†–∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ —Ç–µ—Å—Ç—ã –≤ Node.js.¬†Localhost –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ —Ñ–∞–π–ª—ã –ø–æ¬†`http://`–ø—Ä–æ—Ç–æ–∫–æ–ª—É, —Ç–∞–∫ –∫–∞–∫¬†`file://`–∏–º–µ–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –±–∞–∑–æ–≤–æ–µ¬†`WeakRef`–ø–æ–≤–µ–¥–µ–Ω–∏–µ.¬†–ö–∞–∫ –º—ã –º–æ–∂–µ–º —É–∑–Ω–∞—Ç—å, —á—Ç–æ –æ–±—ä–µ–∫—Ç –ø—Ä–æ—à–µ–ª GCed?¬†–î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:
1.  –ü–æ—Ç–µ—Ä—è—Ç—å/—É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–∏–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç
2.  –í—ã–¥–µ–ª–∏—Ç–µ –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç–µ —Å–∏–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç—Ç–∏ –æ–±—ä–µ–∫—Ç—ã.
3.  –î–µ–ª–∞–π—Ç–µ –º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∏ –ø–∞—É–∑–∞–º–∏, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å —à–∞–Ω—Å—ã –Ω–∞ —Å–±–æ—Ä –º—É—Å–æ—Ä–∞
4.  –¢–µ—Å—Ç WeakRef.

–í–æ—Ç —Ç–∞–∫ –º—ã –º–æ–∂–µ–º –≤—ã–¥–µ–ª—è—Ç—å –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ –∏ –¥–µ–ª–∞—Ç—å –ø–∞—É–∑—ã  

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥:

–ï—Å–ª–∏ –±—ã Runkit –Ω–µ –ø–æ–∫–∞–∑–∞–ª –ø—Ä–∏–º–µ—Ä  

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ GC –º—ã —Ç–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É —Å WeakRef.¬†–¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, —É –Ω–∞—Å –≤—Å–µ –µ—â–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 2 –≤–æ–ø—Ä–æ—Å–∞:

## –ü–æ—á–µ–º—É —É –Ω–∞—Å –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è WeakMaps –∏ WeakSet?

–î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –∫–∞—Ä—Ç—É —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–µ–π:  

–ö–æ–≥–¥–∞ –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ weakRef –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞, –≤—ã —Å—Å—ã–ª–∞–µ—Ç–µ—Å—å –Ω–∞ —Å–∞–º –æ–±—ä–µ–∫—Ç WeakRef –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (¬†`b = {}`).¬†–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–∞–±–æ–≥–æ —Ä–µ—Ñ–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –Ω–∞ –∫–∞—Ä—Ç–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø:  

–ï—Å–ª–∏ –±—ã Runkit –Ω–µ –ø–æ–∫–∞–∑–∞–ª –ø—Ä–∏–º–µ—Ä  

üìù –û–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–∞ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WeakRefs –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–µ–π, –≤—ã –º–æ–∂–µ—Ç–µ –ª–∏–±–æ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Å–∞–º –æ–±—ä–µ–∫—Ç WeakRef, –ª–∏–±–æ –∏–º–µ—Ç—å —Å–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞.  
üìù WeakMap —Å–æ–∑–¥–∞–µ—Ç WeakRef –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–µ–π, –∏ –Ω–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∏—Ö GCed.  
üìù WeakMap –Ω–µ –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥–æ–≤¬†`.entries`–∏–ª–∏¬†`.keys`–∫–∞–∫ –æ–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–∞, –ø–æ—ç—Ç–æ–º—É –º—ã –Ω–µ –º–æ–∂–µ–º –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã WeakMap.¬†WeakMap –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã:¬†`.has`,¬†`.get`,¬†`.set`.

## –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ—á–Ω—ã–π –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –ø–æ–ª—É—á–∞–µ—Ç GCed?

JavaScript –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç¬†#FinalizationRegistry .

üìù¬†`FinalizationRegistry`–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–æ—Å–æ–± –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –≤ —ç—Ç–æ–º —Ä–µ–µ—Å—Ç—Ä–µ –ø–æ–¥–≤–µ—Ä–≥–∞–µ—Ç—Å—è —Å–±–æ—Ä–∫–µ –º—É—Å–æ—Ä–∞.

–ö–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∞ –±—É–¥–µ—Ç –ø–æ—á—Ç–∏ —Ç–∞–∫–∏–º –∂–µ, –Ω–æ –º—ã –≤–∫–ª—é—á–∏–º¬†`FinalizationRegistry`–≤ –ª–æ–≥ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞:

–ï—Å–ª–∏ –±—ã Runkit –Ω–µ –ø–æ–∫–∞–∑–∞–ª –ø—Ä–∏–º–µ—Ä 
  
üìù –û–¥–Ω–∏–º –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è¬†`FinalizationRegistry`—è–≤–ª—è–µ—Ç—Å—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏.¬†–ï—Å–ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ¬†`FinalizationRegistry`–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –µ—Å—Ç—å –ª–∏ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏.

## –ß—Ç–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –±—Ä–∞—É–∑–µ—Ä–∞?

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ—á—Ç–∏ –≤–æ –≤—Å–µ—Ö —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö:¬†[https://caniuse.com/?search=Weak](https://caniuse.com/?search=Weak)

[![–°–ª–∞–±–∞—è —Å—Å—ã–ª–∫–∞](https://res.cloudinary.com/practicaldev/image/fetch/s--4nI_n_4a--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hjxyqxy7jxamdsfxb1uy.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--4nI_n_4a--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hjxyqxy7jxamdsfxb1uy.png)  
[![–°–ª–∞–±–∞—è –∫–∞—Ä—Ç–∞](https://res.cloudinary.com/practicaldev/image/fetch/s--QSnMGJTu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gbssv3o9se5bm7o6emic.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--QSnMGJTu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gbssv3o9se5bm7o6emic.png)  
[![–°–ª–∞–±—ã–π –Ω–∞–±–æ—Ä](https://res.cloudinary.com/practicaldev/image/fetch/s--Ob9nuRvR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2di4wgy2kks72anwajca.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Ob9nuRvR--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/2di4wgy2kks72anwajca.png)  
[![–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–µ—Å—Ç—Ä–∞](https://res.cloudinary.com/practicaldev/image/fetch/s--_YU4Zx52--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cg16wvz3czco7bk0fxti.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--_YU4Zx52--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/cg16wvz3czco7bk0fxti.png)

–°–µ–≥–æ–¥–Ω—è –º—ã –æ–±—Å—É–¥–∏–ª–∏ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ –∏ –æ–±—ä–µ–∫—Ç–Ω—ã–µ —Ç–∏–ø—ã, —Å–ª–µ–¥—É—è –∑–∞ —Å–ª–∞–±—ã–º–∏ –∏ —Å–∏–ª—å–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏, –∏ –ø–æ—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏ —Å —Ç–µ–º, –∫–∞–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –≤–æ—Ç-–≤–æ—Ç –±—É–¥–µ—Ç –ø–æ–¥–≤–µ—Ä–≥–Ω—É—Ç —Å–±–æ—Ä–∫–µ –º—É—Å–æ—Ä–∞.