____

tags: #JavaScript #promise #

_____

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç #promise 

![[Pasted image 20230328094207.png]]

#Promise ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –≤ #JavaScript, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç ¬´—Å–æ–∑–¥–∞—é—â–∏–π¬ª –∏ ¬´–ø–æ—Ç—Ä–µ–±–ª—è—é—â–∏–π¬ª –∫–æ–¥—ã –≤–º–µ—Å—Ç–µ –∫–æ—Ç–æ—Ä–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É Promises/A+¬†[https://promisesaplus.com/](https://promisesaplus.com/)

```javascript
new Promise((resolve, reject) => {...})
```
–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç 2 –∞—Ä–≥—É–º–µ–Ω—Ç–∞: #resolve –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±–µ—â–∞–Ω–∏—è –∏ #reject –¥–ª—è –µ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è.

–û–±–µ—â–∞–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ 1 –∏–∑ 3 —Ä–∞–∑–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π: –≤ –æ–∂–∏–¥–∞–Ω–∏–∏, –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ.
![[Pasted image 20230328094449.png]]

–ö–∞–∫ —Ç–æ–ª—å–∫–æ –æ–±–µ—â–∞–Ω–∏–µ –º–µ–Ω—è–µ—Ç —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ, –µ–≥–æ –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Å–Ω–æ–≤–∞.
![–í –æ–∂–∏–¥–∞–Ω–∏–∏ => –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ => –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ](https://res.cloudinary.com/practicaldev/image/fetch/s--MVkW1duV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/aqjwbm1vsl2vh1fjd9us.png)

```javascript
const result = new Promise((resolve, reject) => {
  resolve(1); // pending => fulfilled with value === 1
  resolve(2); // promise is already fulfilled. No effect
  resolve(3); // promise is already fulfilled. No effect
});

result.then((value) => console.log(value)); // 1
```

–ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º¬†#then, –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–º–∏—Å–æ–≤:  
```javascript
function onResolve(value) {}
function onReject(reason) {}
new Promise((resolve, reject) => {...}).then(onResolve, onReject)
```

#then –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥, –∫–æ–≥–¥–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –æ–±–µ—â–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ.

–ö–∞–∂–¥—ã–π¬†`.then`–æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.¬†
–í–æ–∑–º–æ–∂–Ω—ã 2 —Å—Ü–µ–Ω–∞—Ä–∏—è:
1.  –û–±–µ—â–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
2.  –ü—Ä–æ–º–∏—Å –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã –≤—ã–∑–≤–∞–ª–∏¬†`.then`, –ø–æ—ç—Ç–æ–º—É –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ #microtask –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã –¥–æ—Å—Ç–∏–≥–Ω–µ–º –∫–æ–Ω—Ü–∞ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ –∏ –≤—ã–ø–æ–ª–Ω–∏–º —Ä–∞–Ω–µ–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏.

```javascript
// –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∑–∞–¥–∞—á—É
let resolve; 
const result = new Promise((_resolve) => {
  resolve = _resolve;
});

setTimeout(() => {console.log(3)}, 0); // –ó–∞–ø–ª–∞–Ω–∏—Ä—É–µ–º —Ç–∞–π–º-–∞—É—Ç, 
// –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞–¥–∞—á–µ macrotask

result.then(value => console.log(1)); // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ onResolve
// –∫ promise, –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è

resolve('Hey'); // —Ä–∞–∑—Ä–µ—à–∏—Ç—å promise —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º == 'Hey'
//   –í —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –≤—Å–µ —Ä–∞–Ω–µ–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã `.then`
// –±—É–¥—É—Ç –ø–æ–º–µ—â–µ–Ω–µ–Ω—ã –≤ –æ—á–µ—Ä–µ–¥—å –º–∏–∫—Ä–æ–∑–∞–¥–∞—á
// –£ –Ω–∞—Å –±—É–¥–µ—Ç –æ—á–µ—Ä–µ–¥—å –º–∏–∫—Ä–æ–∑–∞–¥–∞—á:
// value => console.log(1);

result.then(value => console.log(2)); // –í—Å—Ç–∞–≤–∏–º –Ω–æ–≤—ã–π –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤
// –û—á–µ—Ä–µ–¥—å –º–∏–∫—Ä–æ–∑–∞–¥–∞—á:
// value => console.log(1);
// value => console.log(2)

// –ö–æ–Ω–µ—Ü –º–∞–∫—Ä–æ–∑–∞–¥–∞—á
// –í—ã–ø–æ–ª–Ω–∏—Ç—å 2 –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏ –æ–¥–Ω—É –∑–∞ –¥—Ä—É–≥–æ–π –∏ –≤—ã–≤–µ—Å—Ç–∏ 1, 2
// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∏–∫—Ä–æ–∑–∞–¥–∞—á
// –í—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–æ–≤—É—é –º–∞–∫—Ä–æ–∑–∞–¥–∞—á—É –ø–æ —Ç–∞–π–º-–∞—É—Ç—É
// –≤—ã–≤–µ—Å—Ç–∏ 3
```

–ö–∞–∂–¥—ã–π¬†`then`–≤—ã–∑–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±–µ—â–∞–Ω–∏—è.¬†
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º ¬´—Å–≤—è–∑—ã–≤–∞—Ç—å¬ª –ø—Ä–æ–º–∏—Å—ã:

![[Pasted image 20230328095902.png]]

`.then` –æ–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á:

–ï—Å–ª–∏ —É –Ω–∞—Å –≤ –æ—á–µ—Ä–µ–¥–∏ 3 #macrotask, —Ç–æ –æ–Ω–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–∞ –∑–∞ –¥—Ä—É–≥–æ–π:
![[Pasted image 20230328095934.png]]

–û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –º—ã –ø–ª–∞–Ω–∏—Ä—É–µ–º –º–∏–∫—Ä–æ–∑–∞–¥–∞—á—É –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–π –∏–∑ –∑–∞–¥–∞—á, —Ç–æ —ç—Ç–∞ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–π –º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∏:¬†–ï—Å–ª–∏ –∫–æ–¥ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –º–∏–∫—Ä–æ–∑–∞–¥–∞—á—É –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–π –∑–∞–¥–∞—á–∏, —ç—Ç–∞ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–π –∑–∞–¥–∞—á–∏, –Ω–æ –ø–µ—Ä–µ–¥ —Ç—Ä–µ—Ç—å–µ–π –∑–∞–¥–∞—á–µ–π, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ —Ç—Ä–µ—Ç—å—è –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ ‚Äã‚Äã–≤ –æ—á–µ—Ä–µ–¥—å —Ä–∞–Ω—å—à–µ.
![[Pasted image 20230328100031.png]]

–ú–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∞–∫—Ä–æ–∑–∞–¥–∞—á
–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –æ–±–µ—â–∞–Ω–∏–π –º–æ–∂–µ—Ç ¬´–∑–∞–º–æ—Ä–æ–∑–∏—Ç—å¬ª –≤–∫–ª–∞–¥–∫—É:

```javascript
function freeze(value) {
  console.log(value)
  return Promise.resolve(value + 1)
    .then(freeze); // –ó–¥–µ—Å—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
  // –Ω–æ –æ–Ω–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –º–∏–∫—Ä–æ–∑–∞–¥–∞—á—É,
  // —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∏,
  // –≤–∫–ª—é—á–∞—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ UI
}
freeze(1);
```

–ü–æ—Å–∫–æ–ª—å–∫—É –ø—Ä–æ–º–∏—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ #–æ—á–µ—Ä–µ–¥—å-–º–∏–∫—Ä–æ–∑–∞–¥–∞—á , –æ–Ω–∏ –∏–º–µ—é—Ç –Ω–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫.  –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —ç—Ç–æ –ø–æ–±–ª–∏–∂–µ.  

–ß—Ç–æ–±—ã –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É, –º—ã –º–æ–∂–µ–º –ª–∏–±–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤¬†#then –º–µ—Ç–æ–¥—É, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬†#catch.  
–í–æ–æ–±—â–µ –≥–æ–≤–æ—Ä—è¬†`.catch`, —ç—Ç–æ –ø—Å–µ–≤–¥–æ–Ω–∏–º –¥–ª—è .then –±–µ–∑ –ø–µ—Ä–≤–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞:

```javascript
.catch(onReject)
// —Ä–∞–≤–Ω–æ:
.then(value => value, onReject)
```

–ö–æ–≥–¥–∞ –ø—Ä–æ–º–∏—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è, –æ–Ω –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ¬†`onResolve` –æ–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã –¥–æ –ø–µ—Ä–≤–æ–≥–æ¬†`onReject` –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

```javascript
Promise.reject('fail')
 .then(value => console.log(1)) // –ù–∏—á–µ–≥–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
 .then(value => console.log(2)) // –ù–∏—á–µ–≥–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
 .catch(reason => console.log(reason)) // –≤—ã–≤–µ–¥–µ—Ç "–ü—Ä–æ–≤–∞–ª–µ–Ω–æ"
```

`.catch`,¬†`.then` —Å –æ–±—Ä–∞—Ç–Ω—ã–º –≤—ã–∑–æ–≤–æ–º onReject –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–µ—â–∞–Ω–∏–µ.¬†–ï—Å–ª–∏ –≤—ã –Ω–µ –æ—Ç–∫–ª–æ–Ω–∏—Ç–µ –æ–±–µ—â–∞–Ω–∏–µ —Å–Ω–æ–≤–∞, –æ–Ω–æ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:
```javascript
Promise.reject('fail')
 .catch(reason => console.log(reason)) // –≤—ã–≤–µ–¥–µ—Ç "–ü—Ä–æ–≤–∞–ª–µ–Ω–æ", –≤–µ—Ä–Ω–µ—Ç `undefined`
 .then(value => console.log(value)) // –≤—ã–≤–µ–¥–µ—Ç `undefined`
 .catch(reason => console.log('fail 2')) // –ù–∏—á–µ–≥–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, promise —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
```

–≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞¬†`try{}catch(e){}` –±–ª–æ–∫–∏.¬†–ï—Å–ª–∏ –≤—ã –ø–æ–ø–∞–¥–∞–µ—Ç–µ –≤¬†`catch(e) {}` –±–ª–æ–∫–∏—Ä–æ–≤–∫—É, –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–¥–∞—Ç—å –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –µ–µ –ø–æ–∑–∂–µ.¬†–¢–æ –∂–µ —Å–∞–º–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±–µ—â–∞–Ω–∏—è–º–∏.

–í–º–µ—Å—Ç–æ¬†`error`—Å–æ–±—ã—Ç–∏—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—Ç–∫–∞–∑—ã –æ—Ç –æ–±–µ—â–∞–Ω–∏–π —Å–æ–∑–¥–∞—é—Ç¬†`unhandledrejection`—Å–æ–±—ã—Ç–∏–µ.
```javascript
globalThis.addEventListener("unhandledrejection", (event) => {
  console.warn(`unhandledrejection: ${event.reason}`);
});
Promise.reject('test');

// –ù–∞–ø–µ—á–∞—Ç–∞–µ—Ç: 'unhandledrejection: test'
```

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç –æ–±–µ—â–∞–Ω–∏–µ:  
```javascript
Promise.resolve(1)
  .then(value => {throw value + 1})
  .catch(reason => console.log(reason)) // –í—ã–≤–µ–¥–µ—Ç 2
```

–í –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –≤—ã –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å Promise.reject:  
```javascript
Promise.resolve(1)
  .then(value => Promise.reject(value + 1))
  .catch(reason => console.log(reason)) // –í—ã–≤–µ–¥–µ—Ç 2
```

–ö–æ–≥–¥–∞ –≤—ã —Ä–∞–∑—Ä–µ—à–∞–µ—Ç–µ –æ–±–µ—â–∞–Ω–∏–µ, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –µ–≥–æ —Å –ø–æ–º–æ—â—å—é Promise. #reject —Ç–∞–∫–∂–µ –æ—Ç–∫–ª–æ–Ω–∏—Ç –µ–≥–æ:  
```javascript
new Promise(resolve => resolve(Promise.reject(1)))
  .then(value => Promise.reject(2))
  .catch(reason => console.log(reason)) // prints 1
```

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã

üìùPromise.all –ø–æ–∑–≤–æ–ª—è–µ—Ç –∂–¥–∞—Ç—å –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –≤—Å–µ –æ–±–µ—â–∞–Ω–∏—è –∏–∑–º–µ–Ω—è—Ç —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∏–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –æ–±–µ—â–∞–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ  

```javascript
const a = Promise.resolve(1);
const b = new Promise((resolve) => {
  setTimeout(() => resolve('foo'), 1000);
});
const c = Promise.resolve('bar');

Promise.all([a, b, c]).then(console.log); // [1, 'foo', 'bar']
```

[![–û–±–µ—â–∞–π –≤—Å–µ](https://res.cloudinary.com/practicaldev/image/fetch/s--wzAj1dEu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/wtkug033er3sehobkiww.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--wzAj1dEu--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/wtkug033er3sehobkiww.png)

–ï—Å–ª–∏ –∫–∞–∫–æ–µ-–ª–∏–±–æ –∏–∑ –æ–±–µ—â–∞–Ω–∏–π –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ, Promise.all —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω:  

```javascript
const a = Promise.reject(1); // Now we reject the promise
const b = new Promise((resolve) => {
  setTimeout(() => resolve('foo'), 1000);
});
const c = Promise.resolve('bar');

Promise.all([a, b, c])
  .then(console.log) // Nothing
  .catch(console.log); // 1
```

üìù Promise.allSettled –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –∏–∑–º–µ–Ω—è—Ç —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.¬†–û–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –æ–±–µ—â–∞–Ω–∏–π.  

```javascript
const a = Promise.reject(1); // rejected promise

// 2 resolved promises
const b = new Promise((resolve) => {
  setTimeout(() => resolve('foo'), 1000);
});
const c = Promise.resolve('bar');

Promise.allSettled([a, b, c]).then(console.log); 
// [
//   {status: 'rejected', reason: 1}
//   {status: 'fulfilled', value: 'foo'}
//   {status: 'fulfilled', value: 'bar'}
// ]
```

üìù –ú–µ—Ç–æ–¥ Promise.race() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–µ—â–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∏–∑ –æ–±–µ—â–∞–Ω–∏–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏–ª–∏ –ø—Ä–∏—á–∏–Ω–æ–π –∏–∑ —ç—Ç–æ–≥–æ –æ–±–µ—â–∞–Ω–∏—è.  

```javascript
const a = Promise.reject(1); // rejected promise

// 2 resolved promises
const b = new Promise((resolve) => {
  setTimeout(() => resolve('foo'), 1000);
});
const c = Promise.resolve('bar');

Promise.race([a, b, c])
  .then(console.log) // nothing, as the first promise `a` is rejected
  .catch(console.log) // 1
```

üìù –ï—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤ Promise.race –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –æ–±–µ—â–∞–Ω–∏–π, Promise.race –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

–ò—Ç–∞–∫, –µ—Å–ª–∏ –º—ã –∏–∑–º–µ–Ω–∏–º¬†`Promise.race([a,b,c])`–ø–µ—Ä–≤—ã–π –ø—Ä–∏–º–µ—Ä –Ω–∞ ,¬†`Promise.race([b,c,a])`–≤–æ–∑–≤—Ä–∞—â–µ–Ω–Ω–æ–µ –æ–±–µ—â–∞–Ω–∏–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º ¬´bar¬ª:  

```javascript
const a = Promise.reject(1); // rejected promise

// 2 resolved promises
const b = new Promise((resolve) => {
  setTimeout(() => resolve('foo'), 1000);
});
const c = Promise.resolve('bar');

// We put 'a' at the very end
Promise.race([b, c, a])
  .then(console.log) // 'bar'
  .catch(console.log) // nothing
```

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç—Ä—é–∫, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–∏ —É–∂–µ –≤–∞—à–µ –æ–±–µ—â–∞–Ω–∏–µ.

---

_–ü–æ–¥–≤–æ–¥—è –∏—Ç–æ–≥, –≤ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –±–∞–∑–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø—Ä–æ–º–∏—Å–æ–≤ –∏ –¥–µ—Ç–∞–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.¬†–°–ª–µ–¥—É—é—â–∏–µ —Å—Ç–∞—Ç—å–∏ –±—É–¥—É—Ç –ø–æ—Å–≤—è—â–µ–Ω—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º—É –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é, —Å–±–æ—Ä–∫–µ –º—É—Å–æ—Ä–∞ –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º —Å –æ–±—ä–µ–∫—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å._

## –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å #promise –∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –æ—á–µ—Ä–µ–¥—å promise

### TL&DR

>1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–±–µ—â–∞–Ω–∏—è  
>2. –û–±–µ—â–∞–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å  

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å promise

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã —Å–æ–∑–¥–∞–ª–∏ –ø—Ä–æ–º–∏—Å, –≤—ã –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø—Ä–æ–º–∏—Å¬†`pending` –≤—Å–µ¬†`fulfilled` –µ—â–µ¬†`rejected`.

–í—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–º–∏—Å–∞ –≤ –æ—Ç–ª–∞–¥—á–∏–∫–µ:  
[![DevTools –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–±–µ—â–∞–Ω–∏—è](https://res.cloudinary.com/practicaldev/image/fetch/s--sm7H1Q_E--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4qn2t3t9sd3jbthpjmg1.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--sm7H1Q_E--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/4qn2t3t9sd3jbthpjmg1.png)

–ò–∑ –æ—Ç–ª–∞–¥—á–∏–∫–∞ –º—ã –≤–∏–¥–∏–º, —á—Ç–æ¬†`[[PromiseState]]`–∑–∞ —ç—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç Symbol.¬†
–û–¥–Ω–∞–∫–æ¬†`PromiseState`—ç—Ç–æ –Ω–µ¬†[–æ–±—â–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–∏–º–≤–æ–ª](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol#well-known_symbols)¬†, –ø–æ—ç—Ç–æ–º—É –º—ã –º–æ–∂–µ–º –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ —ç—Ç–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é –∫–∞–∫ –∫ —á–∞—Å—Ç–Ω–æ–º—É –ø–æ–ª—é, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å ¬´–ø—Ä—è–º–æ —Å–µ–π—á–∞—Å¬ª.

–û–¥–Ω–∞–∫–æ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ¬†`Promise.race`–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–º–∏—Å–∞.¬†–î–ª—è —ç—Ç–æ–≥–æ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é¬†`Promise.race`:

üìù Promise.race –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–µ—â–∞–Ω–∏—è –≤ –∏—Ö –ø–æ—Ä—è–¥–∫–µ.¬†–ù–∞–ø—Ä–∏–º–µ—Ä:  
```javascript
const a = Promise.resolve(1);
const b = Promise.resolve(2);
Promise.race([a, b]).then(console.log); // 1
```

–ò –≤ —Ç–æ –≤—Ä–µ–º—è:  
```javascript
const a = Promise.resolve(1);
const b = Promise.resolve(2);
Promise.race([b, a]).then(console.log); // 2
```

üìù –≠—Ç–æ—Ç –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–±–µ—â–∞–Ω–∏—è:  
```javascript
const pending = {
  state: 'pending',
};

function getPromiseState(promise) {
  // –ú—ã —Å—Ç–∞–≤–∏–º promise ¬´–æ–∂–∏–¥–∞–Ω–∏–µ¬ª –ø–æ—Å–ª–µ promise –ø—Ä–æ–≤–µ—Ä–∏—Ç—å,
  // —á—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç .race —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `promise`
  return Promise.race([promise, pending]).then(
    (value) => {
      if (value === pending) {
        return value;
      }
      return {
        state: 'resolved',
        value
      };
    },
    (reason) => ({ state: 'rejected', reason })
  );
}
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ¬†[https://codesandbox.io/s/restless-sun-njun1?file=/src/index.js](https://codesandbox.io/s/restless-sun-njun1?file=/src/index.js)  

```javascript
(async function () {
  let result = await getPromiseState(Promise.resolve("resolved hello world"));
  console.log(result);

  result = await getPromiseState(Promise.reject("rejected hello world"));
  console.log(result);

  result = await getPromiseState(new Promise(() => {}));
  console.log(result);

  result = await getPromiseState("Hello world");
  console.log(result);
})();
```

–ü–æ–º–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∫–∏, —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è¬†`Promise.race`–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –∫–æ–¥–∞ —Å —Ç–∞–π–º-–∞—É—Ç–∞–º–∏.¬†–ù–∞–ø—Ä–∏–º–µ—Ä:  

```javascript
const TIMEOUT = 5000;
const timeout = new Promise((_, reject) => setTimeout(() => reject('timeout'), TIMEOUT));

// –ú—ã –º–æ–∂–µ–º –∑–∞—Ö–æ—Ç–µ—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É, –µ—Å–ª–∏ —Ç–∞–π–º-–∞—É—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω
// –ø–µ—Ä–µ–¥ —Ç—Ä—É–¥–æ–µ–º–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ
// –æ—Ç–º–µ–Ω–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
async function someAsyncCode() {/*...*/}

const result = Promise.race([someAsyncCode(), timeout]);
```

### –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –æ—á–µ—Ä–µ–¥—å –æ–±–µ—â–∞–Ω–∏–π

–ò–Ω–æ–≥–¥–∞ –≤–∞–º –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑–Ω—ã–µ –±–ª–æ–∫–∏ –∫–æ–¥–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º.¬†–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞ —É –≤–∞—Å –º–Ω–æ–≥–æ —Ç—è–∂–µ–ª—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.¬†

–ú—ã –¥–æ–ª–∂–Ω—ã –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ:  
üìù JS —è–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–º, –ø–æ—ç—Ç–æ–º—É —É –Ω–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
–î–ª—è —ç—Ç–æ–≥–æ –º—ã –º–æ–∂–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –æ–±–µ—â–∞–Ω–∏–π.¬†–≠—Ç–∞ –æ—á–µ—Ä–µ–¥—å –±—É–¥–µ—Ç –ø–æ–º–µ—â–∞—Ç—å –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ä–∞–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º —ç—Ç–æ—Ç –∫–æ–¥–æ–≤—ã–π –±–ª–æ–∫:  

```javascript
class Queue {
  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞
  queue = Promise.resolve();

  enqueue(fn) {
    // –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –æ—á–µ—Ä–µ–¥–∏
    const result = this._queue.then(fn);

    // –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.
    // –ú—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —É–ª—É—á—à–µ–Ω–∏—è.
    this._queue = result.then(() => {}, () => {});

    // –ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–µ—â–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –¥–∞–≤–∞–π—Ç–µ –≤–µ—Ä–Ω–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç `fn`
    return result;
  }

  // –ï—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º –ø—Ä–æ—Å—Ç–æ –ø–æ–Ω—è—Ç—å, –∫–æ–≥–¥–∞ –æ—á–µ—Ä–µ–¥—å –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å
  wait() {
    return this._queue;
  }
}
```

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º —ç—Ç–æ:  

```javascript
// –†–∞–±–æ—á–∏–π —Å–∏–º—É–ª—è—Ç–æ—Ä
const emulateWork = (name, time) => () => {
    console.log(`Start ${name}`);
    return new Promise((resolve) => {setTimeout(() => console.log(`End ${name}`) || resolve(), time)})
}

// –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å, –µ—Å–ª–∏ –æ–±–µ—â–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
const failTest = () => () => {
    console.log(`Start fail`);
    return Promise.reject();
}
const queue = new Queue();
queue.enqueue(emulateWork('A', 500));
queue.enqueue(emulateWork('B', 500));
queue.enqueue(emulateWork('C', 900));
queue.enqueue(emulateWork('D', 1200));
queue.enqueue(emulateWork('E', 200));
queue.enqueue(failTest());
queue.enqueue(emulateWork('F', 900));
```

–£ –Ω–∞—Å –±—É–¥–µ—Ç –≤—ã–≤–æ–¥:  
[![–í—ã–≤–æ–¥ –æ—á–µ—Ä–µ–¥–∏ –æ–±–µ—â–∞–Ω–∏–π](https://res.cloudinary.com/practicaldev/image/fetch/s--qGtn_gvM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/saym4ah7wixxdogcrrcx.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--qGtn_gvM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/saym4ah7wixxdogcrrcx.png)
–û–¥–Ω–∞–∫–æ, –∫–æ–≥–¥–∞ –æ–±–µ—â–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è, –º—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É.  
–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥ –≤—ã–π–¥–µ—Ç –∏–∑ —Å—Ç—Ä–æ—è, –º—ã –º–æ–∂–µ–º –Ω–∏–∫–æ–≥–¥–∞ –æ–± —ç—Ç–æ–º –Ω–µ —É–∑–Ω–∞—Ç—å.

üìù –ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –ø—Ä–æ–º–∏—Å–∞–º–∏, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬†`.catch` –≤ –∫–æ–Ω—Ü–µ —Ü–µ–ø–æ—á–∫–∏ –ø—Ä–æ–º–∏—Å–æ–≤, –∏–Ω–∞—á–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–±–æ–∏ –≤ —Å–≤–æ–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏!

–ß—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é, –º—ã –º–æ–∂–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:  

```javascript
class Queue {
  _queue = Promise.resolve();

  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é onError –ø—É—Å—Ç.
  _onError = () => {};

  constructor(onError) {
    this._onError = onError;
  }

  enqueue(fn) {
    const result = this._queue.then(fn);

    this._queue = result.then(() => {}, this._onError);

    return result;
  }

  wait() {
    return this._queue;
  }
}
```

–ò–ª–∏ –º—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–≤–æ–æ—Ä—É–∂–∏—Ç—å –æ–±–µ—â–∞–Ω–∏–µ!  

```javascript
class Queue {
  _queue = Promise.resolve();

  enqueue(fn) {
    const result = this._queue.then(fn);
    this._queue = result.then(() => {}, () => {});

    // –º—ã –∏–∑–º–µ–Ω–∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π result.them()
    // –ø–µ—Ä–µ–≤–æ–æ—Ä—É–∂–∏—Ç—å—Å—è promise
    return result.then();
  }

  wait() {
    return this._queue;
  }
}
```

–¢–æ—Ç –∂–µ —Ç–µ—Å—Ç —Å–æ–æ–±—â–∏—Ç –æ–± –æ—à–∏–±–∫–µ!  
[![–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](https://res.cloudinary.com/practicaldev/image/fetch/s--sneBhqXn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hm1idwr9zcwlqx9xxme8.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--sneBhqXn--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/hm1idwr9zcwlqx9xxme8.png)
üìù –ö–∞–∂–¥–∞—è —Ü–µ–ø–æ—á–∫–∞ –ø—Ä–æ–º–∏—Å–æ–≤ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É unhandledRejection.

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –∫–æ–¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–æ–∑–¥–∞–µ–º:¬†[https://codesandbox.io/s/adoring-platform-cfygr5?file=/src/index.js .](https://codesandbox.io/s/adoring-platform-cfygr5?file=/src/index.js)

### –ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤

–ü—Ä–æ–º–∏—Å—ã —á—Ä–µ–∑–≤—ã—á–∞–π–Ω–æ –ø–æ–ª–µ–∑–Ω—ã, –∫–æ–≥–¥–∞ –Ω–∞–º –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ–∂–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

–í —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç–∞—Ç—å—è—Ö –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º, –ø–æ—á–µ–º—É –ø—Ä–æ–º–∏—Å—ã –≤ JS –∏–Ω–æ–≥–¥–∞ –Ω–∞–∑—ã–≤–∞—é—Ç¬†`thenable`–æ–±—ä–µ–∫—Ç–∞–º–∏, –∏ –ø—Ä–æ–¥–æ–ª–∂–∏–º –Ω–∞—à–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã.

## –°–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞ –∏ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏

Promise –≤ #JavaScript ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.¬†–û–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö —á–∞—Å—Ç–µ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –º—ã –º–æ–∂–µ–º —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏, –∏ –ø–æ—ç—Ç–æ–º—É —á—Ä–µ–∑–≤—ã—á–∞–π–Ω–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, –∫–æ–≥–¥–∞ –ø—Ä–æ–º–∏—Å—ã –ø–æ–¥–≤–µ—Ä–≥–∞—é—Ç—Å—è —Å–±–æ—Ä–∫–µ –º—É—Å–æ—Ä–∞ –∏ —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞ –ø—Ä–æ–º–∏—Å–æ–≤.

### TL&DR

1.  [–í —ç—Ç–æ–º codeandbox](https://codesandbox.io/s/promises-article-first-example-8jfyh?file=/src/index.js)¬†–µ—Å—Ç—å –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–∏—Å–æ–≤ –∏ —Ü–µ–ø–æ—á–µ–∫.¬†–û—Ç–∫—Ä–æ–π—Ç–µ –ø–µ—Å–æ—á–Ω–∏—Ü—É –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –µ–µ.¬†–í—ã –º–æ–∂–µ—Ç–µ –±–µ–∂–∞—Ç—å¬†`Promise example`—Å–Ω–∞—á–∞–ª–∞ –∏¬†`then example`–ø–æ—Å–ª–µ.

2.  –í –∫–æ–Ω—Ü–µ —Å—Ç–∞—Ç—å–∏ –≤—ã –Ω–∞–π–¥–µ—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∏–∑ —Å—Ç–∞—Ç—å–∏.

---

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –æ–± –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å  

–≠—Ç–∞ —Å—Ç–∞—Ç—å—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤ –Ω–µ–π –∏—Å—Å–ª–µ–¥—É–µ—Ç—Å—è, –∫–∞–∫ #GC (—Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞) —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–º–∏—Å–∞–º–∏.¬†–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–º–∏—Å–∞—Ö, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏–º–∏ —Å—Ç–∞—Ç—å—è–º–∏ —ç—Ç–æ–π —Å–µ—Ä–∏–∏.

–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬†`FinalizationRegistry`, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∫–æ–≥–¥–∞ —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç GCed.¬†–ü—Ä–æ—á—Ç–∏—Ç–µ [[020 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é. JS101. –°–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏, FinalizationRegistry]]¬†, –µ—Å–ª–∏ –≤—ã –Ω–µ –∑–Ω–∞–∫–æ–º—ã —Å¬†`FinalizationRegistry`.  

–ß—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞, –º—ã —Å–æ–∑–¥–∞–¥–∏–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∏–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏ —É–¥–∞–ª–∏–º –∫ –Ω–∏–º —Å–∏–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.¬†#DevTools –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –ø–æ—ç—Ç–æ–º—É —É –≤–∞—Å –±—É–¥—É—Ç –ª–æ–∂–Ω–æ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

#FinalizationRegistry –≤—ã–≤–æ–¥–∏—Ç –≤ –∫–æ–Ω—Å–æ–ª—å —Å—Ç—Ä–æ–∫—É –∏ –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.

–í–∞–∂–Ω–æ –∏–º–µ—Ç—å –≤ –≤–∏–¥—É, —á—Ç–æ –µ—Å–ª–∏ –æ–±–µ—â–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è GC, —ç—Ç–æ –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω–æ –±—É–¥–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–æ–±—Ä–∞–Ω–æ.¬†–ü—Ä–æ—Ü–µ—Å—Å GC –≤ JavaScript –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é —Å—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è JavaScript.

–ù–∞–±—Ä–æ—Å–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

### –Ø–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–æ–º–∏—Å:

```javascript
const promise = new Promise((resolve, reject) => {...});
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —É –Ω–∞—Å –µ—Å—Ç—å —Å–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ–º–∏—Å, –∏ –º—ã –Ω–µ –±—É–¥–µ–º –µ–≥–æ GC, –ø–æ–∫–∞ –æ–Ω¬†`const promise` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

üìù –ü–æ–∫–∞ –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ —è–≤–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ —Å–≤–æ–µ –æ–±–µ—â–∞–Ω–∏–µ, –æ–Ω–æ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞

### –£–¥–∞–ª–∏—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–µ—â–∞–Ω–∏—è, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:

```javascript
let promiseWithoutResolve = new Promise((resolve) => {
  setTimeout(() => {
    console.log("Timeout for the promise that keeps no refs");
  }, 100000);
});

finalizationRegistry.register(promiseWithoutResolve, " which keeps no references"); 
promiseWithoutResolve = null;
```

–î–ª—è —ç—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞ –º—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –Ω–∏ —Å–∏–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –Ω–∞¬†`promise`, –Ω–∏¬†`resolve`—Ñ—É–Ω–∫—Ü–∏–∏, –æ–¥–Ω–∞–∫–æ —Ñ—É–Ω–∫—Ü–∏—è –æ–±–µ—â–∞–Ω–∏—è –∏–º–µ–µ—Ç –¥–æ–≤–æ–ª—å–Ω–æ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π —Ç–∞–π–º-–∞—É—Ç.

üìù –ö–æ–≥–¥–∞ –≤—ã —Ç–µ—Ä—è–µ—Ç–µ –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞¬†`resolve`,¬†`reject`–∏ —Å–∞–º —ç–∫–∑–µ–º–ø–ª—è—Ä, –æ–±—ä–µ–∫—Ç –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ GC, –∏ –∫–∞–∫ —Ç–æ–ª—å–∫–æ GC –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –æ–Ω –±—É–¥–µ—Ç —Å–æ–±—Ä–∞–Ω.¬†
(–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: JS GC –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∫–æ–ª–µ–Ω–∏–π, –ø–æ—ç—Ç–æ–º—É, –µ—Å–ª–∏ –≤–∞—à –ø—Ä–æ–º–∏—Å –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ç—Ä–µ—Ç—å–µ–º—É –ø–æ–∫–æ–ª–µ–Ω–∏—é, –æ–Ω –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω).

### –ö—ç—à¬†`resolve` –∏/–∏–ª–∏¬†`reject` –º–µ—Ç–æ–¥ –±–µ–∑ —Å—Ç—Ä–æ–≥–æ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–∞–º —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±–µ—â–∞–Ω–∏—è

–í —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤—ã—Ö –±–∞–∑–∞—Ö –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ –ø–æ—Ö–æ–∂–µ–µ –Ω–∞:  

```javascript
let resolve;
let promise = new Promise((_resolve) => { 
  resolve = _resolve;
});
// Let's remove the reference to promise
promise = null;
```

–≠—Ç–æ—Ç –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç 2 –≤–µ—â–∏:  
1) –£–¥–∞–ª—è–µ—Ç —Å–∏–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–æ–º–∏—Å  
2) –ö—ç—à–∏—Ä—É–µ—Ç¬†`resolve` —Ñ—É–Ω–∫—Ü–∏—é –≤–Ω–µ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –ø—Ä–æ–º–∏—Å–∞.

–£ –Ω–∞—Å –±–æ–ª—å—à–µ –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±–µ—â–∞–Ω–∏—é, –Ω–æ –Ω–µ—è—Å–Ω–æ, –±—É–¥–µ—Ç –ª–∏ —ç—Ç–æ –æ–±–µ—â–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞ –∏–ª–∏ –æ–Ω–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è, –ø–æ–∫–∞ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª¬†`resolve`.

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –º—ã –º–æ–∂–µ–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç:  

```javascript
let promiseWithResolve = new Promise((resolve) => {
  setTimeout(() => {
    resolve();
  }, 100000);
});

finalizationRegistry.register(promiseWithResolve , " which keeps resolve function"); 
promiseWithResolve = null;
```

–î–ª—è —Ç–∞–∫–æ–≥–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ —É –Ω–∞—Å –µ—Å—Ç—å –≤—ã—Ö–æ–¥:  

```javascript
Promise  which keeps resolve function. Time taken: 155765. 
```

üìù –ü—Ä–æ–º–∏—Å –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø–∞–º—è—Ç–∏ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —É –Ω–∞—Å –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞¬†`resolve`–∏–ª–∏¬†`reject`–æ–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã.  
üìù –ï—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å –æ–±–µ—â–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∂–∏–≤–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–∏, –æ–Ω–æ –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –∫ —Å—Ç–∞—Ä—à–µ–º—É –ø–æ–∫–æ–ª–µ–Ω–∏—é, –∞ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–µ–∂–¥—É –ø–æ—Ç–µ—Ä–µ–π –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ–±–µ—â–∞–Ω–∏–µ –∏ –µ–≥–æ —Å–±–æ—Ä–∫–æ–π –ø—Ä–æ–π–¥–µ—Ç –µ—â–µ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏.

### `.then` - —Ü–µ–ø–æ—á–∫–∞

–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:  

```javascript
new Promise(() => {}).then(() => {/* Some async code */}) 
```

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:  

```javascript
let promiseWithThen = new Promise(() => {});
let then = promiseWithThen.then(() => {
  console.log("then reached");
});

finalizationRegistry.register(promiseWithThen, " with `then` chain");
finalizationRegistry.register(then, " then callback");

promiseWithThen = then = null;
```

–í—ã—Ö–æ–¥:  

```javascript
Promise  with `then` chain. Time taken: 191. 
Promise  then callback. Time taken: 732. 
```

–û—Ä–∏–≥–∏–Ω–∞–ª¬†`promiseWithThen` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω, –Ω–æ –æ–Ω —Å–≤—è–∑–∞–Ω —Å–ª–µ–¥—É—é—â–µ–π¬†`then`–æ–ø–µ—Ä–∞—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–µ –æ–±–µ—â–∞–Ω–∏–µ.¬†–ö —Å—á–∞—Å—Ç—å—é,¬†`then` —ç—Ç–æ –Ω–µ –º–µ—à–∞–µ—Ç –ø—Ä–æ–º–∏—Å—É –±—ã—Ç—å GCed.

üìù¬†`.then` –Ω–µ –º–µ—à–∞–µ—Ç –æ–±–µ—â–∞–Ω–∏—é –æ—Ç GC.¬†–¢–æ–ª—å–∫–æ —è–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–±–µ—â–∞–Ω–∏–µ —Å–∞–º–æ –ø–æ —Å–µ–±–µ¬†`resolve`–∏¬†`reject`–∏–º–µ—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.

### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, –µ—Å–ª–∏ –º—ã –¥–æ–±–∞–≤–∏–º¬†`.then` –∫ —ç—Ç–∏–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º?

–ö–∞–∫ –º—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏,¬†`.then`.¬†–Ω–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ–±–µ—â–∞–Ω–∏—è –æ—Ç —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞.¬†–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å –Ω–∏–∫–∞–∫–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞.

–ß—Ç–æ–±—ã –¥–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ, –º—ã –º–æ–∂–µ–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è¬†`Then example` –≤ —ç—Ç–æ–π –ø–µ—Å–æ—á–Ω–∏—Ü–µ:¬†[https://codesandbox.io/s/promises-article-first-example-8jfyh?file=/src/index.js .](https://codesandbox.io/s/promises-article-first-example-8jfyh?file=/src/index.js)

–ö–æ–≥–¥–∞ –≤—ã –∑–∞–ø—É—Å—Ç–∏—Ç–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç, –≤—ã —É–≤–∏–¥–∏—Ç–µ, —á—Ç–æ –æ–Ω¬†`then` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –∏–º–µ–µ—Ç –Ω–∏–∫–∞–∫–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∏ –Ω–µ –º–µ–Ω—è–µ—Ç –Ω–∏–∫–∞–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

### –ü–æ—á–µ–º—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ç–µ–π .then –¥–µ—Ä–∂–∞—Ç –æ–±–µ—â–∞–Ω–∏–µ?

–ò–Ω–æ–≥–¥–∞ –≤ –∫–æ–¥–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Ü–µ–ø–æ—á–∫–∏ .then:  

```javascript
Promise.resolve()
  .then(asyncCode1)
  .then(asyncCode2)
  ...
  .then(asyncCodeN);
```

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –º—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–æ–º–∏—Å, –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å GC –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ —Ü–µ–ø–æ—á–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.  
–î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ¬†`Promise.resolve()`–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å, –∞ –ø–µ—Ä–≤—ã–π¬†`.then` –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–∫—Ä–æ–∑–∞–¥–∞—á—É, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø—Ä–æ–º–∏—Å —Ä–∞–∑—Ä–µ—à–µ–Ω.¬†–ò—Ç–∞–∫, —É –Ω–∞—Å –±—É–¥–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

`.then` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–µ—â–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–≤—è–∑–∞–Ω–æ —Å–ª–µ–¥—É—é—â–µ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π (¬†`asyncCode2`, ...).¬†–ê –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî —ç—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ¬†`.then` –±–ª–æ–∫–∞ (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ fn¬†`asyncCode1`).

üìù –µ—Å–ª–∏ –≤–∞—à–∞¬†`.then` —Ü–µ–ø–æ—á–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç ¬´—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ¬ª (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –¥–∞–∂–µ –∑–∞–ø—É—â–µ–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ), –æ–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ–±–µ—â–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è,¬†`.then`–∏ –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ –æ–±–µ—â–∞–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ GCed.

### –ü–æ–¥–≤–æ–¥–∏—Ç—å –∏—Ç–æ–≥–∏:

–ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤:

üìù –°—Å—ã–ª–∫–∏ –Ω–∞:¬†`promise instance`—Å–∞–º–æ,¬†`resolve`,¬†`reject`—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–µ—â–∞–Ω–∏–µ –æ—Ç —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞.

üìù¬†`.then`–Ω–µ –º–µ—à–∞–µ—Ç –æ–±–µ—â–∞–Ω–∏—é –æ—Ç GC.

üìù –µ—Å–ª–∏ –≤–∞—à–∞¬†`.then`—Ü–µ–ø–æ—á–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç ¬´—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ¬ª (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –¥–∞–∂–µ –∑–∞–ø—É—â–µ–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ), –æ–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ–±–µ—â–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è,¬†`.then`–∏ –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ –æ–±–µ—â–∞–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ GCed.

üìù –ï—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å –æ–±–µ—â–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∂–∏–≤–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–∏, –æ–Ω–æ –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –∫ —Å—Ç–∞—Ä—à–µ–º—É –ø–æ–∫–æ–ª–µ–Ω–∏—é, –∞ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–µ–∂–¥—É –ø–æ—Ç–µ—Ä–µ–π –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ–±–µ—â–∞–Ω–∏–µ –∏ –µ–≥–æ —Å–±–æ—Ä–∫–æ–π –ø—Ä–æ–π–¥–µ—Ç –µ—â–µ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏.